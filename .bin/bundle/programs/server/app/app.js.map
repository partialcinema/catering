{"version":3,"sources":["meteor://ðŸ’»app/lib/collections/actions.js","meteor://ðŸ’»app/lib/collections/cooks.js","meteor://ðŸ’»app/lib/collections/rehearsals.js","meteor://ðŸ’»app/lib/accounts-config.js","meteor://ðŸ’»app/lib/cooks-list.js","meteor://ðŸ’»app/lib/methods.js","meteor://ðŸ’»app/server/gitignore/google-calendar-refresh-token.js","meteor://ðŸ’»app/server/gitignore/google-client-secret.js","meteor://ðŸ’»app/server/gitignore/user-credentials.js","meteor://ðŸ’»app/server/calendar.js","meteor://ðŸ’»app/server/cooks.js","meteor://ðŸ’»app/server/default-user.js"],"names":["Actions","Mongo","Collection","module","export","exports","default","Cooks","Rehearsals","AccountsTemplates","configure","forbidClientAccountCreation","hideSignUpLink","CANNONICAL_COOKS","CooksList","import","v","cooksDep","Tracker","Dependency","generateFollowers","followers","i","length","thisCook","nextCook","logAction","type","name","previousCook","isUndo","isLoggedInClient","Meteor","isClient","user","canSaveChanges","isServer","insert","index","createdAt","Date","dependency","prepend","cooks","readCooks","unshift","writeCooks","getAt","ensureIndexExists","cooked","generateNextCook","shift","setAt","isSwap","deleteAt","splice","insertAt","swap","i1","i2","firstPerson","secondPerson","undoAction","action","remove","_id","lastIndex","lastCook","whoFollows","push","depend","checkCooks","doc","findOne","value","docs","find","fetch","Error","JSON","stringify","update","$set","console","log","changed","count","methods","clearCooks","global","googleCalendarRefreshToken","googleClientSecrets","username","email","password","CookList","rebuildCooks","google","npmRequire","CLIENT_ID","web","client_id","CLIENT_SECRET","client_secret","OAuth2","auth","oauth2Client","accessToken","refreshToken","setCredentials","access_token","refresh_token","googleAuth","calendar","version","moment","CALENDAR_IDS","rehearsal","show","other","listEvents","parameters","callback","calendarId","events","list","refreshRehearsals","cookList","todayStart","hours","minutes","lastRefreshedAt","oneWeekFromToday","add","format","orderBy","singleEvents","timeMin","timeMax","bindEnvironment","gotRehearsals","pastRehearsals","err","results","now","items","forEach","isPastRehearsal","start","dateTime","isBefore","description","catered","indexOf","toDate","startup","defaultUserCredentials","Accounts","existingUser","findUserByUsername","createUser"],"mappings":"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","file":"/app.js","sourcesContent":["const Actions = new Mongo.Collection('actions')\nexport default Actions\n","const Cooks = new Mongo.Collection('cooks')\nexport default Cooks\n","const Rehearsals = new Mongo.Collection('rehearsals')\nexport default Rehearsals\n","AccountsTemplates.configure({\n  forbidClientAccountCreation: true,\n  hideSignUpLink: true\n})\n","import Cooks from './collections/cooks'\nimport Actions from './collections/actions'\n\n// DON'T FORGET TO REFRESH THE COOKS COLLECTION IF YOU MAKE CHANGES!\nexport const CANNONICAL_COOKS = ['thomas', 'ian', 'alex', 'jeff', 'adriana', 'dane']\n\nconst cooksDep = new Tracker.Dependency()\n\nfunction generateFollowers () {\n  var followers = {}\n  for (var i = 0; i < CANNONICAL_COOKS.length; i++) {\n    var thisCook = CANNONICAL_COOKS[i]\n    var nextCook = null\n    if (CANNONICAL_COOKS[i + 1]) {\n      nextCook = CANNONICAL_COOKS[i + 1]\n    } else {\n      nextCook = CANNONICAL_COOKS[0]\n    }\n    followers[thisCook] = nextCook\n  }\n  return followers\n}\n\nfunction logAction (type, name, i, previousCook, isUndo) {\n  const isLoggedInClient = Meteor.isClient && Meteor.user()\n  const canSaveChanges = isLoggedInClient || Meteor.isServer\n  if (canSaveChanges && !isUndo) {\n    Actions.insert({\n      type: type,\n      name: name,\n      index: i,\n      previousCook: previousCook,\n      createdAt: new Date()\n    })\n  }\n}\n\nvar followers = generateFollowers()\n\nexport default class CooksList {\n  constructor () {\n    this.dependency = cooksDep\n  }\n\n  prepend (name) {\n    var cooks = this.readCooks()\n    cooks.unshift(name)\n    this.writeCooks(cooks)\n  }\n\n  getAt (i) {\n    var cooks = this.readCooks()\n    this.ensureIndexExists(i)\n    return cooks[i]\n  }\n\n  cooked () {\n    this.generateNextCook()\n    var cooks = this.readCooks()\n    var name = cooks[0]\n    cooks.shift()\n    this.writeCooks(cooks)\n    logAction('cooked', name, 0)\n  }\n\n  setAt (i, name, isSwap, isUndo) {\n    var cooks = this.readCooks()\n    this.ensureIndexExists(i)\n    var previousCook = cooks[i]\n    cooks[i] = name\n    this.writeCooks(cooks)\n    if (!isSwap) {\n      logAction('set', name, i, previousCook, isUndo)\n    }\n  }\n\n  deleteAt (index, isUndo) {\n    this.generateNextCook()\n    var cooks = this.readCooks()\n    logAction('delete', cooks[index], index, null, isUndo)\n    cooks.splice(index, 1)\n    this.writeCooks(cooks)\n  }\n\n  insertAt (index, name, isUndo) {\n    var cooks = this.readCooks()\n    cooks.splice(index, 0, name)\n    this.writeCooks(cooks)\n    logAction('insert', name, index, null, isUndo)\n  }\n\n  swap (i1, i2, isUndo) {\n    var firstPerson = this.getAt(i1)\n    var secondPerson = this.getAt(i2)\n    this.setAt(i1, secondPerson, true)\n    this.setAt(i2, firstPerson, true)\n    logAction('swap', [firstPerson, secondPerson], [i1, i2], null, isUndo)\n  }\n\n  undoAction (action) {\n    switch (action.type) {\n      // TODO: add a linter to this project. Run it, and make sure it passes.\n      // I recommend JavaScript standard style:\n      // https://github.com/feross/standard#what-you-might-do-if-youre-clever\n      case 'cooked':\n        this.setAt(0, action.name, false, true)\n        break\n      case 'set':\n        this.setAt(action.index, action.previousCook, false, true)\n        break\n      case 'delete':\n        this.insertAt(action.index, action.name, true)\n        break\n      case 'insert':\n        this.deleteAt(action.index, true)\n        break\n      case 'swap':\n        this.swap(action.index[0], action.index[1], true)\n        break\n    }\n    Actions.remove(action._id)\n  }\n\n  ensureIndexExists (i) {\n    var cooks = this.readCooks()\n    var lastIndex = cooks.length - 1\n    while (i > lastIndex) {\n      this.generateNextCook()\n      cooks = this.readCooks()\n      lastIndex = cooks.length - 1\n    }\n  }\n\n  generateNextCook () {\n    var cooks = this.readCooks()\n    var lastIndex = cooks.length - 1\n    var lastCook = cooks[lastIndex]\n    const nextCook = this.whoFollows(lastCook)\n    cooks.push(nextCook)\n    this.writeCooks(cooks)\n  }\n\n  whoFollows (name) {\n    return followers[name]\n  }\n\n  readCooks () {\n    cooksDep.depend()\n    this.checkCooks()\n    var doc = Cooks.findOne({})\n    if (doc) {\n      return doc.value\n    }\n  }\n\n  checkCooks () {\n    if (Meteor.isServer) {\n      const docs = Cooks.find({}).fetch()\n      if (docs.length > 1) {\n        throw new Error(`Found more than one cooks document in the cooks collection: ${JSON.stringify(docs)}`)\n      } else if (docs.length === 0) {\n        throw new Error('No documents in Cooks collection.')\n      } else if (docs[0] && !docs[0].value) {\n        throw new Error('Document is missing value property')\n      }\n    }\n  }\n\n  writeCooks (cooks) {\n    this.checkCooks()\n    var doc = Cooks.findOne({})\n    if (doc) {\n      Cooks.update(doc._id, {$set: {value: cooks}})\n    } else {\n      console.log('Inserting cooks')\n      Cooks.insert({value: cooks})\n    }\n    cooksDep.changed()\n  }\n\n  count () {\n    return this.readCooks().length\n  }\n}\n","import Cooks from './collections/cooks'\n\nMeteor.methods({\n  clearCooks: function () {\n    Cooks.remove({})\n  }\n})\n","global.googleCalendarRefreshToken = \"1/dKHJZAaUWC7C4ZmOrT99qHDKuXuVxsvyrEp8AWe_s7FIgOrJDtdun6zK6XiATCKT\";\n","global.googleClientSecrets = {\"web\":{\"client_id\":\"650934664824-9jkko6s2klfnsncep2h1bbl9n01fepju.apps.googleusercontent.com\",\"project_id\":\"poetic-genius-115422\",\"auth_uri\":\"https://accounts.google.com/o/oauth2/auth\",\"token_uri\":\"https://accounts.google.com/o/oauth2/token\",\"auth_provider_x509_cert_url\":\"https://www.googleapis.com/oauth2/v1/certs\",\"client_secret\":\"mPReJ6Hv-oJ3gcvDL2v2d6iY\",\"redirect_uris\":[\"http://dev.partialcinema.com/helper/auth\",\"http://dev.partialcinema.com:3000/helper/auth\"]}};\n","export default {\n  username: 'partials',\n  email: 'partialcinemabooking@gmail.com',\n  password: 'Cateringb1rd'\n}\n","import CookList from '../lib/cooks-list'\nimport Cooks from '../lib/collections/cooks'\nimport Rehearsals from '../lib/collections/rehearsals'\nimport rebuildCooks from './cooks'\n\nrebuildCooks()\n\nconst cooks = new CookList()\n\nconst google = Meteor.npmRequire('googleapis')\n// const scopes = ['https://www.googleapis.com/auth/calendar']\nconst CLIENT_ID = global.googleClientSecrets.web.client_id\nconst CLIENT_SECRET = global.googleClientSecrets.web.client_secret\n\nconst OAuth2 = google.auth.OAuth2\nconst oauth2Client = new OAuth2(CLIENT_ID, CLIENT_SECRET, 'http://dev.partialcinema.com:3000/helper/auth')\nconst accessToken = null\nconst refreshToken = global.googleCalendarRefreshToken\n\noauth2Client.setCredentials({\n  access_token: accessToken,\n  refresh_token: refreshToken\n})\n\nconst googleAuth = oauth2Client\nconst calendar = google.calendar({version: 'v3', auth: googleAuth})\nconst moment = Meteor.npmRequire('moment')\n\nconst CALENDAR_IDS = {\n  rehearsal: 'scromh7crg9cm0u695pumsrb4o@group.calendar.google.com',\n  show: 'm0crma3ead736lct9r0f88s1sk@group.calendar.google.com',\n  other: 'ghptaulpabvqsefm19cfhokh54@group.calendar.google.com'\n}\n\nfunction listEvents (type, parameters, callback) {\n  parameters.calendarId = CALENDAR_IDS[type]\n  calendar.events.list(parameters, callback)\n}\n\nfunction refreshRehearsals () {\n  console.log('Refreshing rehearsals.')\n  const cookList = Cooks.findOne({})\n  const todayStart = moment().hours(0).minutes(1)\n  const lastRefreshedAt = moment(cookList.lastRefreshedAt) || todayStart\n  const oneWeekFromToday = todayStart.add(31, 'days')\n\n  console.log(`Last refreshed at ${lastRefreshedAt.format('LLL')}`)\n  listEvents('rehearsal', {orderBy: 'startTime', singleEvents: true, timeMin: lastRefreshedAt.format(), timeMax: oneWeekFromToday.format()}, Meteor.bindEnvironment(gotRehearsals))\n\n  var pastRehearsals = 0\n  function gotRehearsals (err, results) {\n    if (err) {\n      console.log('Error retrieving calendar events: ', err)\n      return\n    }\n\n    Rehearsals.remove({})\n    const now = moment()\n    results.items.forEach(function (rehearsal) {\n      const isPastRehearsal = moment(rehearsal.start.dateTime).isBefore(now)\n      // const humanReadableStartTime = moment(rehearsal.start.dateTime).format('LLL')\n      rehearsal.description = rehearsal.description || ''\n      const catered = rehearsal.description.indexOf('uncatered') < 0\n      // console.log(`Got event startin at ${humanReadableStartTime}`)\n      if (isPastRehearsal) {\n        pastRehearsals++\n        cooks.cooked()\n      } else if (catered) {\n        Rehearsals.insert(rehearsal)\n        if (Rehearsals.find().count() > cooks.count()) {\n          cooks.generateNextCook()\n        }\n      }\n    })\n\n    console.log(`Found ${pastRehearsals} past rehearsals`)\n    Cooks.update(cookList._id, { $set: { lastRefreshedAt: now.toDate() } })\n  }\n}\n\nMeteor.startup(function () {\n  refreshRehearsals()\n})\n\nMeteor.methods({\n  refreshRehearsals\n})\n","import Cooks from '../lib/collections/cooks'\nimport {CANNONICAL_COOKS} from '../lib/cooks-list'\n\nexport default function rebuildCooks () {\n  var cookList = Cooks.findOne({})\n\n  if (!cookList || !cookList.value || cookList.value.length === 0) {\n    console.log('rebuilding cooks')\n    Cooks.remove({})\n    Cooks.insert({ value: CANNONICAL_COOKS })\n  }\n}\n","import defaultUserCredentials from './gitignore/user-credentials'\nimport { Accounts } from 'meteor/accounts-base'\n// import stringify from 'json-stringify-safe'\n\nconst existingUser = Accounts.findUserByUsername(defaultUserCredentials.username)\n\n// const allAccounts = Meteor.users.find({}).fetch()\n// console.log(`Existing user: ${stringify(allAccounts)}`)\n\nif (!existingUser) {\n  Accounts.createUser(defaultUserCredentials)\n}\n"]}